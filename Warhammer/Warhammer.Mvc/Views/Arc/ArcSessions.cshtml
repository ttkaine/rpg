@using Warhammer.Core.Entities
@model Warhammer.Mvc.Models.ArcSessionsViewModel

<div class="content-block session-block">
    <ul>
        @foreach (Session session in Model.Sessions)
        {
            <li>
                <div class="session-container">
                    <h1><a href="@Url.Action("Index", "Page", new { id = session.Id })">@session.ShortName</a></h1>
                    <h2>@session.FullName</h2>
                    <div class="people-box">
                        @if (session.People.Any())
                        {
                            <ul>
                                <li>
                                    @foreach (Person person in session.People)
                                    {
                                        <a href="@Url.Action("Index", "Page", new { id = person.Id })">
                                            <img src="@Url.Action("Image", "Page", new { id = person.Id })" title="@person.FullName" alt="Picture of @person.FullName" class="mini-profile-image" />
                                        </a>
                                    }
                                </li>
                            </ul>
                                    <div class="clearfix"></div>
                        }
                    </div>
                    <div class="log-box">
                        @if (session.People.Any())
                        {
                            <ul>

                                @foreach (Person person in session.People)
                                {
                                    if (person.SessionLogs.Any(l => l.SessionId == session.Id))
                                    {

                                        List<SessionLog> logs = person.SessionLogs.Where(l => l.SessionId == session.Id).ToList();
                                        foreach (SessionLog log in logs)
                                        {
                                            if (log != null)
                                            {
                                                <li>
                                                    <a href="@Url.Action("Index", "Page", new { id = person.Id })">
                                                        <img src="@Url.Action("Image", "Page", new { id = person.Id })" title="@person.FullName" alt="Picture of @person.FullName" class="micro-profile-image" />
                                                    </a>
                                                    @Html.ActionLink(log.FullName, "Index", "Page", new { id = log.Id }, null)
                                                </li>
                                            }
                                        }
                                    }
                                    else
                                    {
                                        if (Model.CanEdit && person.PlayerId.HasValue && person.Player.UserName == User.Identity.Name)
                                        {
                                            <li>
                                                @Html.ActionLink("Create Log For " + person.FullName, "SessionLog", "Create", new { sessionId = session.Id, personId = person.Id }, new { @class = "btn btn-success" })
                                            </li>
                                        }
                                    }
                                }

                            </ul>
                                    <div class="clearfix"></div>
                        }
                    </div>
                </div>
            </li>        }
    </ul>>
</div>
@using Warhammer.Core.Entities
@using Warhammer.Core.Extensions
@model Warhammer.Mvc.Models.SessionListItemViewModel

<li class="session-list-item">
    <h2><a href="@Url.Action("Index", "Page", new {id = Model.Id})">@Model.ShortName</a></h2>
    <h3>@Model.FullName</h3>
    @if (Model.Date != null)
    {
        <div class="session-date">
            @Model.Date.ToShortDateString()
        </div>
    }
    <div class="people-box">
        @if (Model.People.Any())
        {
            foreach (Person person in Model.People)
            {
                <a class="person-item" href="@Url.Action("Index", "Page", new { id = person.Id })">
                    <img src="@person.FileIdentifier.ToImageUrl()" title="@person.FullName" alt="Picture of @person.FullName" class="mini-profile-image" />
                </a>
            }
        }
    </div>
    <div class="session-description">
        @Html.Raw(Model.Description)
    </div>
    <div class="log-box">
        @if (Model.People.Any())
        {
            foreach (Person person in Model.People)
            {
                if (person.SessionLogs.Any(l => l.SessionId == Model.Id))
                {
                    List<SessionLog> logs = person.SessionLogs.Where(l => l.SessionId == Model.Id).ToList();
                    foreach (SessionLog log in logs)
                    {
                        if (log != null)
                        {
                            <div class="log-item">
                                <a href="@Url.Action("Index", "Page", new {id = person.Id})">
                                    <img src="@person.FileIdentifier.ToImageUrl()" title="@person.FullName" alt="Picture of @person.FullName" class="micro-profile-image"/>
                                </a>
                                @Html.ActionLink(log.FullName, "Index", "Page", new {id = log.Id}, null)
                            </div>
                        }
                    }
                }
            }
        }
    </div>
    @if (ViewBag.EditMode && Model.LogButtonPerson != null)
    {
        <div class="new-log-box">
            @Html.ActionLink("Create Log For " + Model.LogButtonPerson.FullName, "SessionLog", "Create", new { sessionId = Model.Id, personId = Model.LogButtonPerson.Id }, new { @class = "btn btn-success" })
        </div>
    }
</li>


@using Warhammer.Core.Entities
@using Warhammer.Core.Extensions
@using Warhammer.Core.Models
@model Warhammer.Mvc.Models.HomePageViewModel
@{
    ViewBag.Title = @Model.SiteName + "- Home Page";
}

@section scripts {
    <script type="text/javascript" src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <script type="text/javascript" src="~/signalr/hubs"></script>
    <script type="text/javascript">
        var rpHub;
        var connected = false;
        $(function () {
            rpHub = $.connection.roleplayHub;

            rpHub.client.updateTextSessionsOnHomePage = function () {
                updateTextSessions();
            };

            $.connection.hub.start().done(function () {
                connected = true;
            });
        });

        function updateTextSessions() {
            // Text session status updates here

            $('#SessionAutoUpdate').submit();
        }
    </script>
}

<div id="homepage" class="content-wrapper">

    <div class="banner-content">
        <div class="header-block">
            <h1 id="fullName">@Model.SiteName</h1>
        </div>

    </div>

    <div class="core-content">


        <div class="content-block">
            @Html.Action("Search", "Home")
        </div>

        <div class="content-block">

            @Html.Action("ActiveTextSessions")

            @Html.Action("UpdatedPages")

            @Html.Action("RecentActivity", "Activity")

        </div>




    </div>

    <div class="core-content">



        @if (Model.MyPeople.Any())
            {
            <div class="content-block">
                <h3>My Characters</h3>

                <table class="table table-striped">
                    <tbody class="list">
                        @foreach (Person person in Model.MyPeople)
                        {
                            <tr>
                                <td><a id="personLink_@person.Id" href="@Url.Action("Index", "Page", new {id = person.Id})"><img src="@Url.Action("Image", "Page", new {id = person.Id}, null)" title="@person.FullName" alt="Picture of @person.FullName" class="mini-profile-image" /></a></td>
                                <td class="name">@person.FullName</td>
                            </tr>

                        }
                    </tbody>
                </table>

            </div>

        }


        @if (Model.OtherPeople.Any())
            {
            <div class="content-block">
                <h3>Player Characters</h3>

                <table class="table table-striped">
                    <tbody class="list">
                        @foreach (PageLinkModel person in Model.OtherPeople)
                        {
                            <tr>
                                <td><a id="personLink_@person.Id" href="@Url.Action("Index", "Page", new {id = person.Id})"><img src="@Url.Action("Image", "Page", new {id = person.Id}, null)" title="@person.FullName" alt="Picture of @person.FullName" class="mini-profile-image" /></a></td>
                                <td class="name">@person.FullName</td>
                            </tr>

                        }
                    </tbody>
                </table>

            </div>

        }

            <div class="content-block">

                @if (Model.TopNpcs.Any())
            {
                    <h3>Top NPCs</h3>

                    <table class="table table-striped">
                        <tbody class="list">
                            @foreach (PageLinkModel person in Model.TopNpcs)
                            {
                                <tr>
                                    <td><a id="personLink_@person.Id" href="@Url.Action("Index", "Page", new {id = person.Id})"><img src="@Url.Action("Image", "Page", new {id = person.Id}, null)" title="@person.FullName" alt="Picture of @person.FullName" class="mini-profile-image" /></a></td>
                                    <td class="name">@person.FullName</td>
                                </tr>

                            }
                        </tbody>
                    </table>
                }
            </div>
        </div>

    <div class="core-content">
        
        @Html.Action("SiteSelector")

        @if (Model.GameDate.HasValue)
        {
            <div class="content-block">

                <div class="panel panel-info">
                    <div class="panel-heading">Current Game Date</div>
                    <div class="panel-body">The @Model.GameDate.Value.ToWarhammerDateString()</div>
                    <div class="panel-footer">@Model.GameDate.Value.ToString("dddd dd MMMM yyyy")</div>
                </div>
            </div>
        }

        <div class="content-block">
            <h3>Recent Comments</h3>
            @Html.Action("Index", "Comment")
        </div>

    </div>
</div>